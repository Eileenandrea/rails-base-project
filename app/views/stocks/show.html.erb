<div class="stock pb-3">
    <div class="stock-basic-info d-flex">
        <div class="stock-logo">
            <img src=<%=@stock.logo%> alt=<%=@stock.name%>>
        </div>
        <div class="stock-details">
            <h1 class="heading-primary heading-primary-h2 stock-name"><%="#{@stock.name} [#{@stock.ticker}]"%></h1>
            <div class="stock-price d-flex">
                <h2 class="stock-price_latest">$ <%=@stock.last_price%></h2>
                <h3 class="stock-price_change stock-price-<%=@stock_quote.change_percent > 0 ? 'gain' : 'loss'%>" ><i class="fas fa-sort-<%=@stock_quote.change_percent > 0 ? 'up' : 'down'%> me-3"></i><%="#{@stock_quote.change}  (#{@stock_quote.change_percent_s})"%></h3>
                <%if current_user.broker?%>
                    <%if current_user.stock_already_tracked?(@stock.ticker)%>
                        <%=link_to user_stock_path(@stock.userstock(current_user)), method: :delete, class:'btn btn-add-remove btn-tracked-remove ms-auto' do%>
                            <span>Already Tracked</span>
                        <%end%>
                    <%else%>
                        <%=link_to 'Add to Portfolio', user_stocks_path(ticker: @stock.ticker), class: "btn btn-xs btn-add-remove btn-success add-stock ms-auto", method: :post, remote: true%>
                    <%end%>
                <%end%>
            </div>
        </div>
    </div>
    <div class="line-break mt-3"></div>
    <div class="stock-description">
        <h4><%=@stock.description%></h4>
    </div>    
    <div class="line-break mt-3"></div>
    <table class="table">
        <tbody>
            <tr>
                <td>
                    <table class="inner-table">
                        <tr>
                            <td class= 'stock-details-label'>Open:</td>
                            <td class= 'stock-details-data'><%=@stock_quote.open%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>Close:</td>
                            <td class= 'stock-details-data'><%=@stock_quote.close%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>Low:</td>
                            <td class= 'stock-details-data'><%=@stock_quote.low%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>High:</td>
                            <td class= 'stock-details-data'><%=@stock_quote.high%></td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table class="inner-table">
                         <tr>
                            <td class= 'stock-details-label'>Volume:</td>
                            <td class= 'stock-details-data'><%=@stock_quote.avg_total_volume%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>Market Cap:</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.market_cap%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>Percent Change (1 year):</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.year_1_change_percent_s%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>PE Ratio:</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.pe_ratio%></td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table class="inner-table">
                        <tr>
                        <td class= 'stock-details-label'>52 week High:</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.week_52_high%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>52 week low:</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.week_52_low%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>moving average (200):</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.day_200_moving_avg%></td>
                        </tr>
                        <tr>
                            <td class= 'stock-details-label'>moving average (50):</td>
                            <td class= 'stock-details-data'>$<%=@stock_key_stats.day_50_moving_avg%></td>
                        </tr>                        
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
    <%if current_user.buyer?%>
        <div class="broker_list">
            <h1>List of Brokers</h1>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Broker</th>
                        <th scope="col">Brokerage fee</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <%@broker_stocks. each do |broker_stock|%>
                        <tr>
                            <th scope="row"><%=broker_stock.user.email%></th>
                            <td>1%</td>
                            <td>
                                <%=link_to 'Buy', new_user_stock_path(broker_stock,transactiontype:'buy'), class: "btn btn-xs btn-success buy-stock"%>      
                                <%if current_user.stock_already_tracked?(@stock.ticker)%>
                                    <%=link_to 'Sell', new_user_stock_path(broker_stock,transactiontype:'sell'), class: "btn btn-xs btn-danger buy-stock"%>
                                <%end%>
                            </td>
                        </tr>
                    <%end%>
                </tbody>
            </table>
        </div>
    <%end%>
</div>
